# 3 次握手 4 次挥手

握手是连接，挥手是断开。

握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。

为什么是3次握手，而不是两次。**为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误。**

client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。

为什么是4次挥手，而不是其他次数。**通俗的来说，两次挥手就可以释放一端到另一端的 TCP 连接，完全释放连接一共需要四次挥手。**

举个例子：A 和 B 打电话，通话即将结束时，A 说 “我没啥要说的了”，B 回答 “我知道了”，于是 A 向 B 的连接释放了。但是 B 可能还会有要说的话，于是 B 可能又巴拉巴拉说了一通，最后 B 说“我说完了”，A 回答“知道了”，于是 B 向 A 的连接释放了，这样整个通话就结束了。

## 3 次握手

是指在建立一个TCP连接时，客户端和服务器会一共发送三个报文段。

- Client 发包，Server 接收。Server: 有 Client 要找我。
- Server 发包，Client 接收。Client: Server 已经收到信息了。
- Client 发包，Server 接收。Server: Client 要准备发送了。

## 4 次挥手

- Client 发包，Server 接收。Server: Client 请求已结束。
- Server 发包，Client 接收。Client: Server 已收到，我等到它关闭。
- Server 发包，Client 接收。Client: Server 此时可以关闭连接了。
- Client 发包，Server 接收。Server: 可以关闭了（然后关闭了连接）。
